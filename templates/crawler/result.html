{% extends 'crawler/base.html' %}
{% load static %}

{% block title %} Showing results {% endblock %}

{% block custom_style %}
<style>

{% for item in list1 %}
#chartjs-tooltip_{{ forloop.counter }} {
			opacity: 1;
			position: absolute;
			background: rgba(224, 224, 224, .9);
			color: black;
			border-radius: 10px;
			-webkit-transition: all .1s ease;
			transition: all .1s ease;
			-webkit-transform: translate(-50%, 0);
			transform: translate(-50%, 0);
			box-shadow: 0 19px 38px rgba(0,0,0,0.30), 0 15px 12px rgba(0,0,0,0.22);
		}
		{% endfor %}

{% for item in list2 %}
#chartjs-tooltip_{{ forloop.counter|add:'2' }} {
			opacity: 1;
			position: absolute;
			background: rgba(224, 224, 224, .9);
			color: black;
			border-radius: 10px;
			-webkit-transition: all .1s ease;
			transition: all .1s ease;
			-webkit-transform: translate(-50%, 0);
			transform: translate(-50%, 0);
			box-shadow: 0 19px 38px rgba(0,0,0,0.30), 0 15px 12px rgba(0,0,0,0.22);
		}
		{% endfor %}

		.chartjs-tooltip-key {
			display: inline-block;
			width: 10px;
			height: 10px;
			margin-right: 10px;
		}
 </style>

  {% endblock %}

{% block body %}

<ul class="breadcrumb">
<li class="breadcrumb-item"><a href="#">LAYOUT</a></li>
<li class="breadcrumb-item active">RESULT</li>
</ul>



<div class="container">

  <ul class="nav nav-tabs">

    {% for query in list1 %}
  <li class="nav-item mr-1"><a href="#tab_{{ forloop.counter }}" class="nav-link {% if forloop.counter == 1 %}active{% endif %}" data-toggle="tab">{{ query }}</a></li>
    {% endfor %}

    {% if list2 %}
  <li class="nav-item mr-1 dropdown">
    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">
      More
    </a>
    <div class="dropdown-menu">
      {% for query in list2 %}
      <a href="#dropdown_{{ forloop.counter }}" class="dropdown-item" data-toggle="tab">{{ query }}</a>
      {% endfor %}
    </div>
  </li>
    {% endif %}
</ul>

<div class="tab-content pt-3">
  {% for query in list1 %}
  <div class="tab-pane fade show {% if forloop.counter == 1 %}active{% endif %}" id="tab_{{ forloop.counter }}">
    <canvas id="chart-area_{{ forloop.counter }}"></canvas>
    <div id="chartjs-tooltip_{{ forloop.counter }}">
                <table></table>
    </div>


  </div>
  {% endfor %}

  {% if list2 %}
  {% for query in list2 %}
  <div class="tab-pane fade" id="dropdown_{{ forloop.counter }}">
    <canvas id="chart-area_{{ forloop.counter|add:'2' }}"></canvas>
    <div id="chartjs-tooltip_{{ forloop.counter|add:'2' }}">
                <table></table>
    </div>
  </div>
  {% endfor %}
  {% endif %}

</div>


</div>






{% endblock %}

{% block script %}

<script
	  src="https://code.jquery.com/jquery-3.3.1.min.js"
	  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
	  crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>


<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>

<script data-cfasync="false" src="../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src="{% static 'js/app.min.js' %}" type="59f984106ec2e39727363fa8-text/javascript"></script>
<script src="{% static 'plugins/chart.js/dist/Chart.min.js' %}" ></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/gh/emn178/chartjs-plugin-labels/src/chartjs-plugin-labels.js"></script>
<script type="59f984106ec2e39727363fa8-text/javascript">
	  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	  })(window,document,'script','../../www.google-analytics.com/analytics.js','ga');

	  ga('create', 'UA-53034621-1', 'auto');
	  ga('send', 'pageview');

	</script>
	
<script>


{% for key, value in count_list1.items %}

Chart.defaults.global.tooltips.custom = function(tooltip) {
			// Tooltip Element
			var tooltipEl = document.getElementById('chartjs-tooltip_{{ forloop.counter }}');

			// Hide if no tooltip
			if (tooltip.opacity === 0) {
				tooltipEl.style.opacity = 0;
				return;
			}

			// Set caret Position
			tooltipEl.classList.remove('above', 'below', 'no-transform');
			if (tooltip.yAlign) {
				tooltipEl.classList.add(tooltip.yAlign);
			} else {
				tooltipEl.classList.add('no-transform');
			}

			function getBody(bodyItem) {
				return bodyItem.lines;
			}



			// Set Text
			if (tooltip.body) {
				var titleLines = tooltip.title || [];
				var bodyLines = tooltip.body.map(getBody);
                var results = {{ temp_list1|safe }}
                var resultLines = results || []

				var innerHtml = '<thead>';

				titleLines.forEach(function(title,i) {
					innerHtml += '<tr><th>' + title + '</th></tr>';
				});
				innerHtml += '</thead><tbody class="text-center mb-2" >';

				bodyLines.forEach(function(body, i) {
					var colors = tooltip.labelColors[i];
					var style = 'background:' + colors.backgroundColor;
					style += '; border-color:' + colors.borderColor;
					style += '; border-width: 2px';
					var span = '<span class="chartjs-tooltip-key" style="' + style + '"></span>';
					innerHtml += '<tr><td>' + span + body + '</td></tr>';
				});


				resultLines.forEach(function(body, i){
				  for(j=0; j<body.length;j++){
				      innerHtml += '<tr><td><a class="btn btn-black btn-sm" data-toggle="modal" data-target="#modalLg_' + j + '" href="#" >' + 'Link ' + j + '</a></td></tr>';
				  }

				});

				innerHtml += '<tr class="mt-2"><td><a href="#">See More</a></td></tr>';

				innerHtml += '</tbody>';

<!--				innerHtml += '<br><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalLg">click me</button><br><a href="google.com">See more</a>';-->

<!--                innerHtml += `{% autoescape off %}{% for key, value in results.items %}-->
<!--                <br>{% for link in value %}-->
<!--                  <a href="{{ link }}">link {{ forloop.counter }}</a><br>-->
<!--                {% endfor %}-->

<!--                {% endfor %}<br><a href="#">See more</a>{% endautoescape %}`;-->

				var tableRoot = tooltipEl.querySelector('table');
				tableRoot.innerHTML = innerHtml;
			}

			var positionY = this._chart.canvas.offsetTop;
			var positionX = this._chart.canvas.offsetLeft;

			// Display, position, and set styles for font
			tooltipEl.style.opacity = 1;
			tooltipEl.style.left = window.pageXOffset + positionX + tooltip.caretX + 'px';
			tooltipEl.style.top = window.pageYOffset + positionY + tooltip.caretY -200+ 'px';
			tooltipEl.style.fontFamily = tooltip._bodyFontFamily;
			tooltipEl.style.fontSize = tooltip.bodyFontSize;
			tooltipEl.style.fontStyle = tooltip._bodyFontStyle;
			tooltipEl.style.padding = tooltip.yPadding + 'px ' + tooltip.xPadding + 'px';
		};


		var config = {
			type: 'doughnut',
			data: {
				datasets: [{
					data: {{ value|safe }},
					backgroundColor: [
						'#111',
						'#f59042',
						'#555644',
						'#444'
					],
				}],
				labels: {{ labels| safe }}
			},
			options: {
				events: ['mousemove', 'mouseout'],
				responsive: true,
				plugins: {
		          labels: [
					    {
					      render: 'label',
					      position: 'outside',
					      fontFamily: '"Montserrat"'
					    },
					    {
					      render: 'percentage',
					      fontFamily: '"Montserrat"',
					      fontColor: "#ffffff"
					    }
					  ]
		        },
				legend: {
					display: true,
					position: 'right'
				},
				onHover: function (event, chartElement) {
			      event.target.style.cursor = chartElement[0] ? 'pointer' : 'default';
			      myPie_{{ forloop.counter }}.update()
    				chartElement[0]._model.outerRadius += 20
  
			    },
				tooltips: {
					enabled: true,
				}
			}
		};


			var ctx_{{ forloop.counter }} = document.getElementById('chart-area_{{ forloop.counter }}').getContext('2d');
			window.myPie_{{ forloop.counter }} = new Chart(ctx_{{ forloop.counter }}, config);

			document.getElementById("chart-area_{{ forloop.counter }}").onclick = function(evt) {
	      var activePoints = myPie_{{ forloop.counter }}.getElementsAtEvent(evt);
	      if (activePoints[0]) {
	        var chartData = activePoints[0]['_chart'].config.data;
	        var idx = activePoints[0]['_index'];

	        var label = chartData.labels[idx];
	        var value = chartData.datasets[0].data[idx];

	        var url = "http://example.com/?label=" + label + "&value=" + value;
	        $('#details').modal('show');
	        // alert(url);
	      }
    };





  
  Chart.pluginService.register({
  beforeDraw: function(chart) {
    var width = chart.chart.width,
        height = chart.chart.height,
        ctx = chart.chart.ctx;

    ctx.restore();
    var fontSize = ((height / 200 )+0.5).toFixed(2);
    ctx.font = fontSize  + "em Montserrat";
    ctx.textBaseline = "middle";

    var text = "FALCON",
        textX = Math.round((width - ctx.measureText(text).width) / 2 - 70),
        textY = height / 2;

    ctx.fillText(text, textX, textY);
    ctx.save();
  }
});

{% endfor %}

  
</script>

<script>


{% for key, value in count_list2.items %}

Chart.defaults.global.tooltips.custom = function(tooltip) {
			// Tooltip Element
			var tooltipEl = document.getElementById('chartjs-tooltip_{{ forloop.counter|add:'2' }}');

			// Hide if no tooltip
			if (tooltip.opacity === 0) {
				tooltipEl.style.opacity = 0;
				return;
			}

			// Set caret Position
			tooltipEl.classList.remove('above', 'below', 'no-transform');
			if (tooltip.yAlign) {
				tooltipEl.classList.add(tooltip.yAlign);
			} else {
				tooltipEl.classList.add('no-transform');
			}

			function getBody(bodyItem) {
				return bodyItem.lines;
			}



			// Set Text
			if (tooltip.body) {
				var titleLines = tooltip.title || [];
				var bodyLines = tooltip.body.map(getBody);
                var results = {{ temp_list1|safe }}
                var resultLines = results || []

				var innerHtml = '<thead>';

				titleLines.forEach(function(title,i) {
					innerHtml += '<tr><th>' + title + '</th></tr>';
				});
				innerHtml += '</thead><tbody class="text-center mb-2" >';

				bodyLines.forEach(function(body, i) {
					var colors = tooltip.labelColors[i];
					var style = 'background:' + colors.backgroundColor;
					style += '; border-color:' + colors.borderColor;
					style += '; border-width: 2px';
					var span = '<span class="chartjs-tooltip-key" style="' + style + '"></span>';
					innerHtml += '<tr><td>' + span + body + '</td></tr>';
				});


				resultLines.forEach(function(body, i){
				  for(j=0; j<body.length;j++){
				      innerHtml += '<tr><td><a class="btn btn-black btn-sm" data-toggle="modal" data-target="#modalLg_' + j + '" href="#" >' + 'Link ' + j + '</a></td></tr>';
				  }

				});

				innerHtml += '<tr class="mt-2"><td><a href="#">See More</a></td></tr>';

				innerHtml += '</tbody>';

<!--				innerHtml += '<br><button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalLg">click me</button><br><a href="google.com">See more</a>';-->

<!--                innerHtml += `{% autoescape off %}{% for key, value in results.items %}-->
<!--                <br>{% for link in value %}-->
<!--                  <a href="{{ link }}">link {{ forloop.counter }}</a><br>-->
<!--                {% endfor %}-->

<!--                {% endfor %}<br><a href="#">See more</a>{% endautoescape %}`;-->

				var tableRoot = tooltipEl.querySelector('table');
				tableRoot.innerHTML = innerHtml;
			}

			var positionY = this._chart.canvas.offsetTop;
			var positionX = this._chart.canvas.offsetLeft;

			// Display, position, and set styles for font
			tooltipEl.style.opacity = 1;
			tooltipEl.style.left = window.pageXOffset + positionX + tooltip.caretX + 'px';
			tooltipEl.style.top = window.pageYOffset + positionY + tooltip.caretY -200+ 'px';
			tooltipEl.style.fontFamily = tooltip._bodyFontFamily;
			tooltipEl.style.fontSize = tooltip.bodyFontSize;
			tooltipEl.style.fontStyle = tooltip._bodyFontStyle;
			tooltipEl.style.padding = tooltip.yPadding + 'px ' + tooltip.xPadding + 'px';
		};


		var config = {
			type: 'doughnut',
			data: {
				datasets: [{
					data: {{ value|safe }},
					backgroundColor: [
						'#111',
						'#f59042',
						'#555644',
						'#444'
					],
				}],
				labels: {{ labels| safe }}
			},
			options: {
				events: ['mousemove', 'mouseout'],
				responsive: true,
				plugins: {
		          labels: [
					    {
					      render: 'label',
					      position: 'outside',
					      fontFamily: '"Montserrat"'
					    },
					    {
					      render: 'percentage',
					      fontFamily: '"Montserrat"',
					      fontColor: "#ffffff"
					    }
					  ]
		        },
				legend: {
					display: true,
					position: 'right'
				},
				onHover: function (event, chartElement) {
			      event.target.style.cursor = chartElement[0] ? 'pointer' : 'default';
			      myPie_{{ forloop.counter|add:'2' }}.update()
    				chartElement[0]._model.outerRadius += 20

			    },
				tooltips: {
					enabled: true,
				}
			}
		};


			var ctx_{{ forloop.counter|add:'2' }} = document.getElementById('chart-area_{{ forloop.counter|add:'2' }}').getContext('2d');
			window.myPie_{{ forloop.counter|add:'2' }} = new Chart(ctx_{{ forloop.counter|add:'2' }}, config);

			document.getElementById("chart-area_{{ forloop.counter|add:'2' }}").onclick = function(evt) {
	      var activePoints = myPie_{{ forloop.counter|add:'2' }}.getElementsAtEvent(evt);
	      if (activePoints[0]) {
	        var chartData = activePoints[0]['_chart'].config.data;
	        var idx = activePoints[0]['_index'];

	        var label = chartData.labels[idx];
	        var value = chartData.datasets[0].data[idx];

	        var url = "http://example.com/?label=" + label + "&value=" + value;
	        $('#details').modal('show');
	        // alert(url);
	      }
    };






  Chart.pluginService.register({
  beforeDraw: function(chart) {
    var width = chart.chart.width,
        height = chart.chart.height,
        ctx = chart.chart.ctx;

    ctx.restore();
    var fontSize = ((height / 200 )+0.5).toFixed(2);
    ctx.font = fontSize  + "em Montserrat";
    ctx.textBaseline = "middle";

    var text = "FALCON",
        textX = Math.round((width - ctx.measureText(text).width) / 2 - 70),
        textY = height / 2;

    ctx.fillText(text, textX, textY);
    ctx.save();
  }
});

{% endfor %}


</script>
<script src="../../ajax.cloudflare.com/cdn-cgi/scripts/7089c43e/cloudflare-static/rocket-loader.min.js" data-cf-settings="59f984106ec2e39727363fa8-|49" defer=""></script></body>

{% endblock %}
